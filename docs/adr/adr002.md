# ADR 002: Choix de la technologie web

## Statut

Acceptée

## Contexte

Pour l'implémentation de l'interface web client de BrokerX, nous devions choisir un framework web Rust approprié. L'application doit fournir :

- Une interface d'authentification (login/registration) sécurisée
- Un tableau de bord client avec informations de compte
- Un système de placement d'ordres 
- Une architecture extensible pour futures fonctionnalités
- Des performances élevées pour traiter les ordres en temps réel

Les principales options considérées étaient Axum, Actix-web, Warp, Rocket et Tide.

## Décision

Nous avons choisi **Axum** comme framework web principal avec:

- **Askama** pour le templating HTML côté serveur
- **Serde** pour la sérialisation des formulaires
- **Tokio** pour le runtime async
- **Arc<Mutex<BrokerX>>** pour l'état partagé thread-safe

## Architecture implémentée

### Structure des modules

```
app/src/web/
├── mod.rs          # Configuration du router
├── handlers.rs     # Logique des handlers (login, register, etc.)
└── templates.rs    # Structures Askama pour le templating
```

### Authentification

- **Login/Register handlers** utilisant `Form<T>` extractors
- **État partagé** avec `State<AppState>` pour accéder au domain layer
- **Validation** intégrée dans les handlers
- **Authentification dans le domain layer** via `broker.users.authenticate(login, password) -> Option<UserId>`

### Templating

- **Templates Askama** pour login.html, register.html, base.html
- **Gestion d'erreurs** avec affichage de messages dans les templates
- **Formulaires** avec validation côté serveur

## Conséquences

### Positives

1. **Type safety**: Extracteurs typés pour formulaires et état partagé
2. **Performance**: Runtime async avec tokio/hyper
3. **Simplicité**: API claire et code maintenable
4. **Intégration domain**: Accès direct au BrokerX via l'état partagé
5. **Extensibilité**: Architecture modulaire

### Négatives

1. **Écosystème récent**: Moins de documentation que Actix-web

### Architecture actuelle

- **État**: `Arc<Mutex<BrokerX>>` passé de main.rs vers tous les handlers
- **Authentification**: Intégrée dans le domain layer (Account avec username/password)
- **Templates**: Server-side rendering pour performance et simplicité
- **Routage**: `/login`, `/register`, `/logout` + formulaires POST
